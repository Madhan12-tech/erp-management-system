<!-- templates/workforce.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workforce Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .modal input, .modal select { margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Workforce / HR Module</h2>

    <!-- Filter -->
    <form method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <select name="site" class="form-select" onchange="this.form.submit()">
                <option value="">Filter by Site</option>
                {% for site in sites %}
                    <option value="{{ site }}" {% if site == request.args.get('site') %}selected{% endif %}>{{ site }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <select name="department" class="form-select" onchange="this.form.submit()">
                <option value="">Filter by Department</option>
                {% for dept in departments %}
                    <option value="{{ dept }}" {% if dept == request.args.get('department') %}selected{% endif %}>{{ dept }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <a href="/export_workforce_excel" class="btn btn-success">Export Excel</a>
            <a href="/export_workforce_pdf" class="btn btn-danger">Export PDF</a>
        </div>
        <div class="col-md-3 text-end">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Workforce</button>
        </div>
    </form>
    <!-- Workforce Table -->
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th><th>Name</th><th>Role</th><th>Dept</th><th>Site</th>
                <th>Salary</th><th>Days</th><th>Leaves</th><th>Bonus</th>
                <th>Deduct</th><th>Total Pay</th><th>Join Date</th>
                <th>Train</th><th>Perf</th><th>Docs</th>
            </tr>
        </thead>
        <tbody>
        {% for row in data %}
            <tr>
                <td>EMP{{ 1000 + row[0] }}</td>
                <td>{{ row[1] }}</td><td>{{ row[2] }}</td><td>{{ row[3] }}</td><td>{{ row[4] }}</td>
                <td>₹{{ row[5] }}</td><td>{{ row[6] }}</td><td>{{ row[7] }}</td>
                <td>₹{{ row[8] }}</td><td>₹{{ row[9] }}</td><td>₹{{ row[10] }}</td>
                <td>{{ row[11] }}</td><td>{{ row[12] }}</td><td>{{ row[13] }}</td>
                <td><a href="{{ row[14] }}" target="_blank">View</a></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content p-3">
      <form method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Add Workforce</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-6"><input type="text" name="name" class="form-control" placeholder="Employee Name" required></div>
          <div class="col-md-6"><input type="text" name="role" class="form-control" placeholder="Role/Position" required></div>
          <div class="col-md-6"><input type="text" name="department" class="form-control" placeholder="Department" required></div>
          <div class="col-md-6"><input type="text" name="site" class="form-control" placeholder="Site Assigned" required></div>
          <div class="col-md-6"><input type="number" step="0.01" name="salary" class="form-control" placeholder="Monthly Salary" required></div>
          <div class="col-md-6"><input type="number" name="days_present" class="form-control" placeholder="Days Present" required></div>
          <div class="col-md-6"><input type="number" name="leaves" class="form-control" placeholder="Leave Days" required></div>
          <div class="col-md-6"><input type="number" step="0.01" name="bonus" class="form-control" placeholder="Bonus Amount" required></div>
          <div class="col-md-6"><input type="number" step="0.01" name="deductions" class="form-control" placeholder="Deductions" required></div>
          <div class="col-md-6"><input type="date" name="joining_date" class="form-control" placeholder="Joining Date" required></div>
          <div class="col-md-6"><select name="training_status" class="form-select">
              <option value="Completed">Training Completed</option>
              <option value="Ongoing">Training Ongoing</option>
              <option value="Not Started">Not Started</option>
          </select></div>
          <div class="col-md-6"><select name="performance" class="form-select">
              <option value="Excellent">Excellent</option>
              <option value="Good">Good</option>
              <option value="Needs Improvement">Needs Improvement</option>
          </select></div>
          <div class="col-md-12"><input type="url" name="documents" class="form-control" placeholder="Document URL (e.g., CV, ID Proof)"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="submit">Add Entry</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
