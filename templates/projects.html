<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Projects | Ducting ERP</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f7f9fb;
      margin: 0;
      padding: 20px;
    }

    h2 {
      color: #2c3e50;
    }

    .btn {
      background-color: #2563eb;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #1d4ed8;
    }

    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-content {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .popup-header h3 {
      margin: 0;
    }

    .close-btn {
      background: none;
      font-size: 18px;
      border: none;
      cursor: pointer;
    }

    .design-process {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .design-step {
      flex: 1;
      padding: 15px;
      background-color: #f1f5f9;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
    }

    .design-step.active {
      border: 2px solid #2563eb;
      background-color: #e0e7ff;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h2>Projects</h2>
  <button class="btn" onclick="openPopup('projectPopup')">+ Add Project</button>

  <!-- Add Project Popup -->
  <div id="projectPopup" class="popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>Add New Project</h3>
        <button class="close-btn" onclick="closePopup('projectPopup')">√ó</button>
      </div>

      <div class="form-group">
        <label>Enquiry ID *</label>
        <input type="text" placeholder="EQ.XXXXXX">
      </div>

      <div class="form-group">
        <label>Vendor Name</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Start Date</label>
        <input type="date">
      </div>

      <div class="form-group">
        <label>End Date</label>
        <input type="date">
      </div>

      <div class="form-group">
        <label>Location</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>GST Number</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Address</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Project Incharge</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Notes</label>
        <textarea placeholder="Optional notes..."></textarea>
      </div>

      <div class="form-group">
        <label>File Upload</label>
        <input type="file" />
        <small>Optional: Design drawings (PDF/image)</small>
      </div>

      <button class="btn" onclick="saveProject()">Save</button>
    </div>
  </div>

  <!-- Design Process Cards -->
  <div id="designSection" class="hidden">
    <h3>Design Process</h3>
    <div class="design-process">
      <div class="design-step active" onclick="openPopup('measurePopup')">
        <strong>Preparation</strong><br>
        <button class="btn" style="margin-top: 5px;">Add Measurement Sheet</button>
      </div>
      <div class="design-step">
        <strong>Completes</strong><br>
        Marked
      </div>
      <div class="design-step">
        <strong>Submit for Approval</strong><br>
        Under Review
      </div>
    </div>
  </div>

  <!-- Measurement Sheet Popup -->
  <div id="measurePopup" class="popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>Add Measurement Sheet</h3>
        <button class="close-btn" onclick="closePopup('measurePopup')">√ó</button>
      </div>

      <div class="form-group">
        <label>Client Name</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Company Name</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Location</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Site Engineer Name</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>Phone Number</label>
        <input type="text">
      </div>

      <button class="btn">Save Measurement</button>
    </div>
  </div>

  <script>
    function openPopup(id) {
      document.getElementById(id).style.display = 'flex';
    }

    function closePopup(id) {
      document.getElementById(id).style.display = 'none';
    }

    function saveProject() {
      closePopup('projectPopup');
      document.getElementById('designSection').classList.remove('hidden');
    }
  </script>
  <!-- Duct Entry Form and Table -->
  <div class="card" style="margin-top: 30px;">
    <h3>Duct Entry</h3>
    <div class="form-group">
      <label>Type</label>
      <input type="text" id="ductType">
    </div>

    <div class="form-group">
      <label>Length (mm)</label>
      <input type="number" id="ductLength">
    </div>

    <div class="form-group">
      <label>Breadth (mm)</label>
      <input type="number" id="ductBreadth">
    </div>

    <div class="form-group">
      <label>Height (mm)</label>
      <input type="number" id="ductHeight">
    </div>

    <div class="form-group">
      <label>Quantity</label>
      <input type="number" id="ductQty">
    </div>

    <button class="btn" onclick="addDuct()">+ Add</button>

    <!-- Duct Table -->
    <table border="1" width="100%" style="margin-top: 20px; border-collapse: collapse;">
      <thead style="background-color: #cbd5e1;">
        <tr>
          <th>Type</th>
          <th>Length</th>
          <th>Breadth</th>
          <th>Height</th>
          <th>Qty</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ductTableBody">
        <!-- JS Filled -->
      </tbody>
    </table>

    <div style="margin-top: 15px;">
      <button class="btn" onclick="submitDucts()">Submit</button>
      <button class="btn" onclick="printPage()">üñ®Ô∏è Print</button>
      <button class="btn" onclick="exportTable()">üì§ Export Excel</button>
    </div>
  </div>

  <script>
    const tableBody = document.getElementById('ductTableBody');
    let ductData = [];

    function addDuct() {
      const type = document.getElementById('ductType').value;
      const length = document.getElementById('ductLength').value;
      const breadth = document.getElementById('ductBreadth').value;
      const height = document.getElementById('ductHeight').value;
      const qty = document.getElementById('ductQty').value;

      if (!type || !length || !breadth || !height || !qty) {
        alert("Fill all fields.");
        return;
      }

      const newRow = {
        type, length, breadth, height, qty
      };

      ductData.push(newRow);
      renderTable();
    }

    function renderTable() {
      tableBody.innerHTML = '';
      ductData.forEach((item, index) => {
        tableBody.innerHTML += `
          <tr>
            <td>${item.type}</td>
            <td>${item.length}</td>
            <td>${item.breadth}</td>
            <td>${item.height}</td>
            <td>${item.qty}</td>
            <td>
              <button onclick="editRow(${index})">Edit</button>
              <button onclick="deleteRow(${index})">Delete</button>
            </td>
          </tr>
        `;
      });
    }

    function deleteRow(i) {
      ductData.splice(i, 1);
      renderTable();
    }

    function editRow(i) {
      const d = ductData[i];
      document.getElementById('ductType').value = d.type;
      document.getElementById('ductLength').value = d.length;
      document.getElementById('ductBreadth').value = d.breadth;
      document.getElementById('ductHeight').value = d.height;
      document.getElementById('ductQty').value = d.qty;
      deleteRow(i);
    }

    function submitDucts() {
      alert("Submitted duct entries!");
      console.log("Submitting:", ductData);
    }

    function printPage() {
      window.print();
    }

    function exportTable() {
      let csv = "Type,Length,Breadth,Height,Qty\n";
      ductData.forEach(d => {
        csv += `${d.type},${d.length},${d.breadth},${d.height},${d.qty}\n`;
      });

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = "duct_data.csv";
      a.click();
    }
  </script>
  <!-- Toast Notifications -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        {% for category, message in messages %}
          <div style="padding: 10px 20px; margin-top: 5px; border-radius: 6px; color: white;
                      background-color: {% if category == 'success' %}#38a169{% elif category == 'error' %}#e53e3e{% else %}#4a5568{% endif %};">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <script>
    // Auto-hide flash messages
    setTimeout(() => {
      const alerts = document.querySelectorAll('[style*="position: fixed"] > div');
      alerts.forEach(alert => alert.style.display = 'none');
    }, 3000);
  </script>

</body>
</html>
